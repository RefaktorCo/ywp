<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8" />
        <meta name="viewport" content="width=device-width" />

        <title>FilePond</title>

        <link rel="icon" href="favicon.ico" />

        <!-- filepond -->
        <link href="./filepond/filepond.css" rel="stylesheet" type="text/css" />
        <link href="./filepond/filepond-plugin-file-poster.css" rel="stylesheet" type="text/css" />

        <!-- pintura -->
        <link href="./pintura/pintura.css" rel="stylesheet" type="text/css" />

        <style>
            main {
                max-width: 30em;
            }
        </style>
    </head>
    <body>
        <main>
            <input type="file" multiple />
        </main>

        <!-- filepond -->
        <script src="./filepond/filepond.js"></script>
        <script src="./filepond/filepond-plugin-file-poster.js"></script>
        <script src="./filepond/filepond-plugin-file-validate-type.js"></script>

        <!-- filepond image editor plugin -->
        <script src="./filepond-plugin-image-editor/FilePondPluginImageEditor.js"></script>

        <!-- pintura image editor -->
        <script type="module">
            import {
                // editor
                openEditor,
                processImage,
                createDefaultImageReader,
                createDefaultImageWriter,
                createDefaultImageOrienter,
                locale_en_gb,
                legacyDataToImageState,

                // plugins
                setPlugins,
                plugin_crop,
                plugin_crop_locale_en_gb,
                plugin_finetune,
                plugin_finetune_defaults,
                plugin_finetune_locale_en_gb,
                plugin_filter,
                plugin_filter_defaults,
                plugin_filter_locale_en_gb,
                plugin_annotate,
                plugin_annotate_locale_en_gb,
                markup_editor_defaults,
                markup_editor_locale_en_gb,
            } from './pintura/pintura.js';

            setPlugins(plugin_crop, plugin_finetune, plugin_filter, plugin_annotate);

            FilePond.registerPlugin(
                FilePondPluginFileValidateType,
                FilePondPluginImageEditor,
                FilePondPluginFilePoster
            );

            var pond = FilePond.create(document.querySelector('input'), {
                imageEditor: {
                    // map legacy data objects to new imageState objects
                    legacyDataToImageState: legacyDataToImageState,

                    // used to create the editor, receives editor configuration, should return an editor instance
                    createEditor: openEditor,

                    // Required, used for reading the image data
                    imageReader: [createDefaultImageReader],

                    // optionally. can leave out when not generating a preview thumbnail and/or output image
                    imageWriter: [
                        createDefaultImageWriter,
                        // optional image writer instructions
                        {
                            targetSize: {
                                width: 384,
                            },
                        },
                    ],

                    // used to generate poster images, runs an editor in the background
                    imageProcessor: processImage,

                    // pintura image editor options
                    editorOptions: {
                        // we want a square crop
                        imageCropAspectRatio: 1,

                        // set editor default properties
                        imageOrienter: createDefaultImageOrienter(),
                        ...plugin_finetune_defaults,
                        ...plugin_filter_defaults,
                        ...markup_editor_defaults,
                        locale: {
                            ...locale_en_gb,
                            ...plugin_crop_locale_en_gb,
                            ...plugin_finetune_locale_en_gb,
                            ...plugin_filter_locale_en_gb,
                            ...markup_editor_locale_en_gb,
                        },
                    },
                },

                /* uncomment to preview the output image */
                /*
                onpreparefile: (fileItem, file) => {
                    const image = new Image();
                    image.src = URL.createObjectURL(file);
                    document.body.appendChild(image);
                },
                */

                /* other FilePond properties */
                allowReorder: true,
                filePosterMaxHeight: 256,
            });
        </script>
    </body>
</html>
